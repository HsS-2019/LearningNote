# 读书笔记系列01—ARC在Objective-C中的实现

> ARC，自动引用计数（Automatic Reference Counting）的缩写，是指在内存管理中对引用采取自动计数的技术。不同于C++中的手动管理内存，和Java中的垃圾回收机制，苹果在Objective-C和后来推出的Swift中都采用了ARC机制，方便编译器进行内存管理。值得一提的是，C++ 11版本引进了智能指针的概念，而智能指针的原理正是自动引用计数。

要了解ARC，我们首先举一个例子，知道一下引用计数是什么意思。

## 了解引用计数

假设有一个只有一盏灯的教室，为了保证教室里有人的时候，灯必须开着照明，因此要求班上来的最早的同学需要开灯，班上走的最晚的同学需要关灯。而为了判断教室里是否还有同学，这里引入了引用计数的概念来计算“教室里还有多少同学”。

- 第一个同学进入教室，“教室里的同学数量”+1，数值从0变为1，因此需要开灯
- 之后，每当有同学进入教室，“教室里的同学数量”就+1
- 每当有同学离开教室，“教室里的同学数量”就-1
- 当最后一个同学离开教室后，“教室里的同学数量”变为0，因此需要关灯

在这个例子里，我们了解了引用计数的工作原理。回到Objective-C中，类比一下，可以发现其实对象相当于教室里的灯，而教室里的同学就相当于持有该对象的实例。

当对象被声明出来时（申请内存并初始化），因为一开始就已经赋值给了一个实例变量/常量，相当于第一个同学进入了教室，所以该对象的引用计数从0变为1。当有其它实例持有该对象，该对象的引用计数会继续+1，而当有实例不再持有该对象，该对象的引用计数也会-1。最后当对象的引用计数变为0时，相当于教室里已经没有同学了，所以释放对象内存。

## 了解MRC

从上面的描述中，我们学习了什么是引用计数，看起来还挺简单的是吧，但是我们需要注意其中的一些操作。了解这些操作的实现，对于我们理解ARC有挺大的帮助的，比如申请内存和初始化时怎么实现的呢？加1操作又是怎么实现的呢
在ARC之前，Objective-C使用的是一种叫做MRC（Mannul Reference Counting）的手动管理内存的机制。


### 参考资料

- [《Objective-C 高级编程 ——iOS与OSX多线程和内存管理》]()